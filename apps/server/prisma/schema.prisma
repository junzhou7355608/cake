generator client {
  provider = "prisma-client-js"
  output   = "../../../packages/types/src/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id              Int         @id @default(autoincrement())                                          // 主键，自增ID
  avatarUrl       String?                                                                            // 头像URL，可选
  username        String      @unique                                                                // 用户名，唯一
  password        String                                                                             // 密码
  role            String                                                                             // 角色
  createdAt       DateTime    @default(now())                                                        // 创建时间，默认当前时间
  updatedAt       DateTime    @updatedAt                                                             // 更新时间，自动更新
}

model Member {
  id              Int         @id @default(autoincrement())                                          // 主键，自增ID
  openid          String      @unique                                                                // 微信openid，唯一
  unionid         String?     @unique                                                                // 微信unionid，唯一，可选
  nickname        String?                                                                            // 昵称，可选
  avatarUrl       String?                                                                            // 头像URL，可选
  gender          Int?                                                                               // 性别，可选
  phone           String?                                                                            // 手机号，可选
  birthday        DateTime?                                                                          // 生日，可选
  status          Int         @default(0)                                                            // 会员状态（0正常 1禁用 2注销等）
  lastLoginAt     DateTime?                                                                          // 最后登录时间，可选
  level           Int?                                                                               // 会员等级，可选
  points          Int         @default(0)                                                            // 积分，默认0
  remark          String?                                                                            // 备注，可选
  referrerId      Int?                                                                               // 推荐人ID，可选
  referrer        Member?     @relation("Referrals", fields: [referrerId], references: [id])         // 推荐人，关联自身
  referrals       Member[]    @relation("Referrals")                                                 // 被推荐的会员列表
  createdAt       DateTime    @default(now())                                                        // 创建时间，默认当前时间
  updatedAt       DateTime    @updatedAt                                                             // 更新时间，自动更新
}

model Order {
  id              Int         @id @default(autoincrement())                                          // 主键，自增ID
  orderNo         String      @unique                                                                // 订单编号，唯一
  memberId        Int                                                                                // 下单会员ID
  deliveryType    Int         @default(0)                                                            // 配送方式（0配送 1自提）
  receiverName    String?                                                                            // 收货人姓名
  receiverPhone   String?                                                                            // 收货人手机号
  receiverAddr    String?                                                                            // 收货地址
  storeId         Int?                                                                               // 自提门店ID
  storeName       String?                                                                            // 自提门店名称
  pickupCode      String?                                                                            // 自提码
  pickupTime      DateTime?                                                                          // 预约自提时间
  createdAt       DateTime    @default(now())                                                        // 创建时间，默认当前时间
  updatedAt       DateTime    @updatedAt                                                             // 更新时间，自动更新
}
